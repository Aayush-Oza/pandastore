<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panda Store ‚Äì Admin Dashboard</title>

    <link rel="stylesheet" href="../assets/css/style.css">
    <script src="../assets/js/chart.js"></script>

    <style>
        .admin-card {
            background: white;
            padding: 22px;
            border-radius: 12px;
            box-shadow: 0 4px 14px rgba(0,0,0,0.08);
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-top: 25px;
        }

        canvas {
            width: 100% !important;
            min-height: 260px;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--red);
            margin-bottom: 10px;
            text-align: center;
        }

        @media (max-width: 900px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
        
    </style>
</head>

<body>

<!-- ================= HEADER ================= -->
<header class="header">
  <div class="container header-inner">
    <div class="brand">
  <span class="brand-icon">üêº</span>
  <span class="brand-text">Panda<span>Store</span></span>
</div>

    <div class="hamburger" onclick="toggleNav()">
      <span></span><span></span><span></span>
    </div>

    <nav class="nav">
      <ul class="nav-list">
        <li><a href="./templates/dashboard.html" style="color:var(--red);font-weight:700;">Dashboard</a></li>
        <li><a href="./templates/add-product.html">Add products</a></li>
        <li><a href="./templates/products.html">Manage products</a></li>
        <li><a href="./templates/customers.html">Customers</a></li>
        <li><a href="./templates/order.html">Orders</a></li>
        <li><a href="./templates/admin-login.html" onclick="logoutUser()">Logout</a></li>
      </ul>
    </nav>
  </div>
</header>
<script>
function logoutAdmin() {
    localStorage.removeItem("is_admin");
    localStorage.removeItem("admin_id");
    window.location.href = "admin-login.html";
}

if (localStorage.getItem("is_admin") !== "true") {
    alert("Admin access only");
    window.location.href = "admin-login.html";
}
</script>

<!-- DASHBOARD -->
<div class="container" style="padding:40px 0;">

    <h2 class="page-title">Admin Dashboard</h2>


    <!-- STATS -->
    <div class="stats-grid">
        <div class="admin-card" id="usersCard"></div>
        <div class="admin-card" id="productsCard"></div>
        <div class="admin-card" id="ordersCard"></div>
        <div class="admin-card" id="revenueCard"></div>
    </div>

    <h3 class="section-title">Sales Analytics</h3>

    <!-- CHARTS -->
    <div class="charts-grid">
        <div class="admin-card">
  <div class="chart-title">Sales by Category</div>
  <canvas id="categoryChart"></canvas>
</div>

        <div class="admin-card">
            <div class="chart-title">Revenue by Category</div>
            <canvas id="revenueChart"></canvas>
        </div>
    </div>

    <div class="admin-card" style="margin-top:25px;">
        <div class="chart-title">Top Selling Products</div>
        <canvas id="topProductsChart"></canvas>
    </div>

</div>
<script src="../assets/js/app.js"></script>
<script>
// -------------------- STATS --------------------
async function loadStats() {
    const res = await fetch(`${CONFIG.API}/analytics/summary`);
    const data = await res.json();

    usersCard.innerHTML = stat("Users", data.users ?? "-");
productsCard.innerHTML = stat("Products", data.products ?? "-");
ordersCard.innerHTML = stat("Orders", data.total_orders);
revenueCard.innerHTML = stat("Revenue", "‚Çπ" + data.total_revenue);

}

function stat(title, value) {
  return `
    <h3 class="admin-stat-title">${title}</h3>
    <p class="admin-stat-value">${value}</p>
  `;
}

// -------------------- CHARTS --------------------
async function loadCategoryChart() {
    const res = await fetch(`${CONFIG.API}/analytics/sales-by-category`);
    const data = await res.json();

    new Chart(categoryChart, {
        type: "pie",
        data: {
            labels: Object.keys(data),
            datasets: [{
                data: Object.values(data),
                backgroundColor: ["#ff9f1c","#d62828","#52b788","#3a86ff","#8338ec"]
            }]
        }
    });
}

async function loadRevenueChart() {
    const res = await fetch(`${CONFIG.API}/analytics/revenue-by-category`);
    const data = await res.json();

    new Chart(revenueChart, {
        type: "bar",
        data: {
            labels: Object.keys(data),
            datasets: [{
                label: "Revenue",
                data: Object.values(data),
                backgroundColor: "#ff9f1c"
            }]
        },
        options: { scales: { y: { beginAtZero: true } } }
    });
}

async function loadTopProducts() {
    const res = await fetch(`${CONFIG.API}/analytics/top-products`);
    const data = await res.json();

    new Chart(topProductsChart, {
        type: "bar",
        data: {
            labels: data.map(i => i.product),
            datasets: [{
                label: "Units Sold",
                data: data.map(i => i.sold),
                backgroundColor: "#d62828"
            }]
        },
        options: { scales: { y: { beginAtZero: true } } }
    });
}

// INIT
loadStats();
loadCategoryChart();
loadRevenueChart();
loadTopProducts();
</script>
</body>
</html>
