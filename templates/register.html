<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chunri Store - Register</title>

    <link rel="stylesheet" href="../assets/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        .input-field {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            margin-bottom: 12px;
        }
        .otp-box {
            display: none;
            margin-top: 15px;
        }
        button {
            width: 100%;
            padding: 12px;
            background: var(--red);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }
        button:disabled {
            background: gray;
        }

    </style>
</head>

<body>

<header class="header">
    <div class="container header-inner">
        <div class="brand">
  <span class="brand-icon">üêº</span>
  <span class="brand-text">Panda<span>Store</span></span>
</div>

    </div>
</header>
<div class="auth-box">
  <h2>Create Account</h2>

  <form id="registerForm" onsubmit="registerUser(event)">

    <input
      class="input-field"
      id="name"
      name="name"
      type="text"
      placeholder="Full Name"
      required
      minlength="3"
      autocomplete="name"
    >

    <input
      class="input-field"
      id="email"
      name="email"
      type="email"
      placeholder="Email Address"
      autocomplete="email"
      required
    >

    <input
      class="input-field"
      id="phone"
      name="phone"
      type="tel"
      placeholder="Phone Number"
      required
      maxlength="10"
      inputmode="numeric"
      autocomplete="tel"
      oninput="this.value=this.value.replace(/[^0-9]/g,'')"
    >

    <input
      class="input-field"
      id="address"
      name="address"
      type="text"
      placeholder="Address"
      required
      minlength="10"
      autocomplete="street-address"
    >

    <div class="password-wrap">
      <input
        type="password"
        id="password"
        name="password"
        class="input-field"
        placeholder="Create Password"
        autocomplete="new-password"
        required
      >
      <span class="eye" onclick="togglePassword('password', this)">üëÅÔ∏è</span>
    </div>

    <div class="password-wrap">
      <input
        type="password"
        id="confirmPassword"
        name="confirmPassword"
        class="input-field"
        placeholder="Confirm Password"
        required
      >
      <span class="eye" onclick="togglePassword('confirmPassword', this)">üëÅÔ∏è</span>
    </div>

    <p id="passwordMsg" style="margin-top:8px;font-size:14px;display:none;"></p>

    <button type="submit">Register</button>
    <p id="registerMsg" style="margin-top:10px; font-size:14px; display:none;"></p>

<div id="otpBox" class="otp-box">
  <input class="input-field" id="otp" placeholder="Enter OTP">
  <button type="button" onclick="verifyRegisterOtp()">Verify OTP</button>
</div>

    <p style="margin-top: 10px; text-align:center;">
      Already have an account?
      <a href="login.html" style="color: var(--orange); font-weight:700;">Login</a>
    </p>

  </form>
</div>

<!-- TOAST -->
<div id="toast" class="toast"></div>
<script src="../assets/js/app.js"></script>
<script>
// üîê PASSWORD RULE
const strongPasswordRegex =
/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{8,}$/;
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
const phoneRegex = /^\d{10}$/;
const passwordInput = document.getElementById("password");
const confirmInput = document.getElementById("confirmPassword");
const passwordMsg = document.getElementById("passwordMsg");
let DEMO_OTP = null;

function showRegisterMsg(text, color = "#333") {
  const msg = document.getElementById("registerMsg");
  msg.style.display = "block";
  msg.style.color = color;
  msg.innerHTML = text;
}

// üî¥üü¢ LIVE PASSWORD VALIDATION
passwordInput.addEventListener("input", () => {
  const value = passwordInput.value.trim();

  if (!value) {
    passwordMsg.style.display = "none";
    return;
  }

  passwordMsg.style.display = "block";

  if (strongPasswordRegex.test(value)) {
    passwordMsg.style.color = "green";
    passwordMsg.textContent = "Strong password ‚úî";
  } else {
    passwordMsg.style.color = "#d62828";
    passwordMsg.innerHTML = `
      Password must contain:
      <br>‚Ä¢ 8+ characters
      <br>‚Ä¢ 1 uppercase letter
      <br>‚Ä¢ 1 lowercase letter
      <br>‚Ä¢ 1 number
      <br>‚Ä¢ 1 special character
    `;
  }
});

function togglePassword(fieldId, icon) {
    const input = document.getElementById(fieldId);

    if (input.type === "password") {
        input.type = "text";
        icon.textContent = "üôà";
    } else {
        input.type = "password";
        icon.textContent = "üëÅÔ∏è";
    }
}

async function registerUser(event) {
  const submitBtn = document.querySelector("#registerForm button");
  submitBtn.disabled = true;
  event.preventDefault();

  const nameInput = document.getElementById("name");
  const emailInput = document.getElementById("email");
  const phoneInput = document.getElementById("phone");
  const addressInput = document.getElementById("address");

  const name = nameInput.value.trim();
  const email = emailInput.value.trim();
  const phone = phoneInput.value.trim();
  const address = addressInput.value.trim();

  if (!name || !email || !phone || !address || !passwordInput.value) {
    showToast("All fields are required");
    submitBtn.disabled = false;
    return;
  }

  if (!emailRegex.test(email)) {
  showToast("Invalid email format");
  submitBtn.disabled = false;
  return;
}

  if (!phoneRegex.test(phone)) {
    showToast("Phone number must be exactly 10 digits");
    submitBtn.disabled = false;
    return;
  }

  if (passwordInput.value !== confirmInput.value) {
  showToast("Passwords do not match");
  submitBtn.disabled = false;
  return;
}

if (!strongPasswordRegex.test(passwordInput.value)) {
  showToast("Weak password");
  submitBtn.disabled = false;
  return;
}

  const res = await fetch(`${CONFIG.API}/auth/register`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      name,
      email,
      phone,
      address,
      password: passwordInput.value.trim()

    })
  });

  const data = await res.json();

  if (!res.ok) {
    showToast(data.error || "Registration failed");
    submitBtn.disabled = false;
    return;
  }

  showToast("Registration successful");

  setTimeout(() => {
    window.location.href = "login.html";
  }, 1200);
}

</script>
</body>
</html>
